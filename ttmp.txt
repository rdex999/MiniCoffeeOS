; A sub-function of kbd_waitForKeycode
; Will wait a given time, but if a key is pressed it will return before the given time
; PARAMS
;   - 0) DI   => The maximum time to wait (in milliseconds)
; RETURNS
;   - 0) In AL, the current keycode after returning
kbdDelayKey:
  push ds
  mov bx, KERNEL_SEGMENT
  mov ds, bx

  call getLowTime
  mov si, ax

  mov dl, ds:[kbdCurrentKeycode]
  sti

.waitLoop:
  hlt
  
  cmp ds:[kbdCurrentKeycode], dl
  jne .retKey

  call getLowTime 
  sub ax, si
  cmp ax, di
  jb .waitLoop

.retKey:
  mov al, ds:[kbdCurrentKeycode]

.end:
  pop ds 
  ret